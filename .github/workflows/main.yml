on:
  push:
    branches:
      - main
       
jobs:
    deploy_job:
     runs-on: ubuntu-latest
     name: deploy
     steps:
       - name: Checkout
         uses: actions/checkout@v3
         timeout-minutes: 5

       - name: List files to be deployed
         run: |
           echo "Files to be deployed:"
           ls -R
         timeout-minutes: 2

       - name: Test SFTP connection
         env:
           SSHPASS: ${{ secrets.FTP_PASSWORD }}
         run: |
           sudo apt-get install -y sshpass
           sshpass -e sftp -o StrictHostKeyChecking=no -P ${{ secrets.FTP_PORT }} ${{ secrets.FTP_USERNAME }}@${{ secrets.FTP_SERVER }} <<EOF
           ls -la
           quit
           EOF
         timeout-minutes: 5

       - name: Prepare for deployment
         run: |
           echo "Preparing files for deployment..."
           # Add any necessary preparation steps here
         timeout-minutes: 5

       - name: Deploy files (part 1)
         uses: wlixcc/SFTP-Deploy-Action@v1.2.4
         with:
            username: ${{ secrets.FTP_USERNAME }}
            password: ${{ secrets.FTP_PASSWORD }}
            server: ${{ secrets.FTP_SERVER }}
            port: ${{ secrets.FTP_PORT }}
            local_path: './*'
            remote_path: /home/electgcs/public_html
            sftp_only: true 
            timeout: 60s
            verbose: true
         timeout-minutes: 10

       - name: Deploy files (part 2)
         if: success() || failure()
         uses: wlixcc/SFTP-Deploy-Action@v1.2.4
         with:
            username: ${{ secrets.FTP_USERNAME }}
            password: ${{ secrets.FTP_PASSWORD }}
            server: ${{ secrets.FTP_SERVER }}
            port: ${{ secrets.FTP_PORT }}
            local_path: './*'
            remote_path: /home/electgcs/public_html
            sftp_only: true 
            timeout: 60s
            verbose: true
         timeout-minutes: 10
