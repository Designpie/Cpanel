on:
  push:
    branches:
      - main
       
jobs:
    deploy_job:
     runs-on: ubuntu-latest
     name: deploy
     steps:
       - name: Checkout
         uses: actions/checkout@v3

       - name: Network diagnostics
         run: |
           echo "Attempting to connect to ${{ secrets.FTP_SERVER }} on port ${{ secrets.FTP_PORT }}"
           nc -zv ${{ secrets.FTP_SERVER }} ${{ secrets.FTP_PORT }} -w 10
           echo "Tracing route to server:"
           traceroute ${{ secrets.FTP_SERVER }}
           echo "DNS lookup:"
           nslookup ${{ secrets.FTP_SERVER }}

       - name: Deploy file
         uses: wlixcc/SFTP-Deploy-Action@v1.2.4
         with:
            username: ${{ secrets.FTP_USERNAME }}
            password: ${{ secrets.FTP_PASSWORD }}
            server: ${{ secrets.FTP_SERVER }}
            port: ${{ secrets.FTP_PORT }}
            remote_path: /home/electgcs/public_html
            sftp_only: true 
            timeout: 120s
            verbose: true
