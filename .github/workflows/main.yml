on:
  push:
    branches:
      - main
       
jobs:
    deploy_job:
     runs-on: ubuntu-latest
     name: deploy
     steps:
       - name: Checkout
         uses: actions/checkout@v3

       - name: List files to be deployed
         run: |
           echo "Files to be deployed:"
           ls -R

       - name: Test SFTP connection
         env:
           SSHPASS: ${{ secrets.FTP_PASSWORD }}
         run: |
           sudo apt-get install -y sshpass
           sshpass -e sftp -o StrictHostKeyChecking=no -P ${{ secrets.FTP_PORT }} ${{ secrets.FTP_USERNAME }}@${{ secrets.FTP_SERVER }} <<EOF
           ls -la
           quit
           EOF

       - name: Deploy file
         uses: wlixcc/SFTP-Deploy-Action@v1.2.4
         with:
            username: ${{ secrets.FTP_USERNAME }}
            password: ${{ secrets.FTP_PASSWORD }}
            server: ${{ secrets.FTP_SERVER }}
            port: ${{ secrets.FTP_PORT }}
            remote_path: /home/electgcs/public_html
            sftp_only: true 
            timeout: 300s
            verbose: true
